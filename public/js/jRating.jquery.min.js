(function(e){e.fn.jRating=function(t){var n={bigStarsPath:"/img/icons/stars.png",smallStarsPath:"img/icons/small.png",phpPath:"php/jRating.php",type:"big",step:false,isDisabled:false,showRateInfo:true,canRateAgain:false,sendRequest:true,length:5,decimalLength:0,rateMax:20,rateInfosX:-45,rateInfosY:5,nbRates:1,onSuccess:null,onError:null,onClick:null};if(this.length>0)return this.each(function(){function y(e){var t=parseFloat(e*100/d*parseInt(r.rateMax)/100);var n=Math.pow(10,parseInt(r.decimalLength));var i=Math.round(t*n)/n;return i}function b(){switch(r.type){case"small":s=12;o=10;u=r.smallStarsPath;break;default:s=23;o=20;u=r.bigStarsPath}}function w(e){if(!e)return 0;return e.offsetLeft+w(e.offsetParent)}var r=e.extend(n,t),i=0,s=0,o=0,u="",a=false,f=0,l=r.nbRates;if(e(this).hasClass("jDisabled")||r.isDisabled)var c=true;else var c=false;b();e(this).height(o);var h=parseFloat(e(this).attr("data-average")),p=parseInt(e(this).attr("data-id")),d=s*r.length,v=h/r.rateMax*d,m=e("<div>",{"class":"jRatingColor",css:{width:v}}).appendTo(e(this)),h=e("<div>",{"class":"jRatingAverage",css:{width:0,top:-o}}).appendTo(e(this)),g=e("<div>",{"class":"jStar",css:{width:d,height:o,top:-(o*2),background:"url("+u+") repeat-x"}}).appendTo(e(this));e(this).css({width:d,overflow:"hidden",zIndex:1,position:"relative"});if(!c)e(this).unbind().bind({mouseenter:function(t){var n=w(this);var i=t.pageX-n;if(r.showRateInfo)var s=e("<p>",{"class":"jRatingInfos",html:y(i)+' <span class="maxRate">/ '+r.rateMax+"</span>",css:{top:t.pageY+r.rateInfosY,left:t.pageX+r.rateInfosX}}).appendTo("body").show()},mouseover:function(t){e(this).css("cursor","pointer")},mouseout:function(){e(this).css("cursor","default");if(a)h.width(f);else h.width(0)},mousemove:function(t){var n=w(this);var o=t.pageX-n;if(r.step)i=Math.floor(o/s)*s+s;else i=o;h.width(i);if(r.showRateInfo)e("p.jRatingInfos").css({left:t.pageX+r.rateInfosX}).html(y(i)+' <span class="maxRate">/ '+r.rateMax+"</span>")},mouseleave:function(){e("p.jRatingInfos").remove()},click:function(t){var n=this;a=true;f=i;l--;if(!r.canRateAgain||parseInt(l)<=0)e(this).unbind().css("cursor","default").addClass("jDisabled");if(r.showRateInfo)e("p.jRatingInfos").fadeOut("fast",function(){e(this).remove()});t.preventDefault();var s=y(i);h.width(i);e(".datasSent p").html("<strong>idBox : </strong>"+p+"<br /><strong>rate : </strong>"+s+"<br /><strong>action :</strong> rating");e(".serverResponse p").html("<strong>Loading...</strong>");if(r.onClick)r.onClick(n,s);if(r.sendRequest){e.post(r.phpPath,{idBox:p,rate:s,action:"rating"},function(t){if(!t.error){e(".serverResponse p").html(t.server);if(r.onSuccess)r.onSuccess(n,s)}else{e(".serverResponse p").html(t.server);if(r.onError)r.onError(n,s)}},"json")}}});})}})(jQuery)